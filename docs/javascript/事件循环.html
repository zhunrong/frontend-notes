<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>事件循环 | Frontend Notes</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/frontend-notes/logo.jpg">
    <link rel="manifest" href="/frontend-notes/manifest.json">
    <meta name="description" content="前端知识点">
    <meta name="theme-color" content="#3eaf7c">
    
    <link rel="preload" href="/frontend-notes/assets/css/0.styles.b070197c.css" as="style"><link rel="preload" href="/frontend-notes/assets/js/app.70366b76.js" as="script"><link rel="preload" href="/frontend-notes/assets/js/2.3a2be5ef.js" as="script"><link rel="preload" href="/frontend-notes/assets/js/22.d41561ec.js" as="script"><link rel="preload" href="/frontend-notes/assets/js/3.22db767b.js" as="script"><link rel="prefetch" href="/frontend-notes/assets/js/10.40fb480d.js"><link rel="prefetch" href="/frontend-notes/assets/js/11.e8d1b3f7.js"><link rel="prefetch" href="/frontend-notes/assets/js/12.e7dd3279.js"><link rel="prefetch" href="/frontend-notes/assets/js/13.50fe36dc.js"><link rel="prefetch" href="/frontend-notes/assets/js/14.599714c7.js"><link rel="prefetch" href="/frontend-notes/assets/js/15.3c723b2f.js"><link rel="prefetch" href="/frontend-notes/assets/js/16.6a95be55.js"><link rel="prefetch" href="/frontend-notes/assets/js/17.75616d0b.js"><link rel="prefetch" href="/frontend-notes/assets/js/18.1663c2a2.js"><link rel="prefetch" href="/frontend-notes/assets/js/19.deb6eba7.js"><link rel="prefetch" href="/frontend-notes/assets/js/20.04dcf709.js"><link rel="prefetch" href="/frontend-notes/assets/js/21.67de2533.js"><link rel="prefetch" href="/frontend-notes/assets/js/23.1a621639.js"><link rel="prefetch" href="/frontend-notes/assets/js/24.20970c33.js"><link rel="prefetch" href="/frontend-notes/assets/js/25.642c6c7e.js"><link rel="prefetch" href="/frontend-notes/assets/js/26.2c78c3af.js"><link rel="prefetch" href="/frontend-notes/assets/js/27.4346fc45.js"><link rel="prefetch" href="/frontend-notes/assets/js/28.45eae6dd.js"><link rel="prefetch" href="/frontend-notes/assets/js/29.69680b72.js"><link rel="prefetch" href="/frontend-notes/assets/js/30.28a12472.js"><link rel="prefetch" href="/frontend-notes/assets/js/31.db4f1bf6.js"><link rel="prefetch" href="/frontend-notes/assets/js/32.5b0a1058.js"><link rel="prefetch" href="/frontend-notes/assets/js/33.54f10f84.js"><link rel="prefetch" href="/frontend-notes/assets/js/34.0cf8e4b9.js"><link rel="prefetch" href="/frontend-notes/assets/js/35.5a8dc4e1.js"><link rel="prefetch" href="/frontend-notes/assets/js/36.4091d06b.js"><link rel="prefetch" href="/frontend-notes/assets/js/37.e8537f41.js"><link rel="prefetch" href="/frontend-notes/assets/js/38.3a332fc7.js"><link rel="prefetch" href="/frontend-notes/assets/js/39.885e7913.js"><link rel="prefetch" href="/frontend-notes/assets/js/4.5936c4c4.js"><link rel="prefetch" href="/frontend-notes/assets/js/40.dc1e682c.js"><link rel="prefetch" href="/frontend-notes/assets/js/41.f7bbec3a.js"><link rel="prefetch" href="/frontend-notes/assets/js/5.33850136.js"><link rel="prefetch" href="/frontend-notes/assets/js/6.51684ca2.js"><link rel="prefetch" href="/frontend-notes/assets/js/7.4efd9018.js"><link rel="prefetch" href="/frontend-notes/assets/js/8.fc42a4c2.js"><link rel="prefetch" href="/frontend-notes/assets/js/9.39059156.js">
    <link rel="stylesheet" href="/frontend-notes/assets/css/0.styles.b070197c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/frontend-notes/" class="home-link router-link-active"><!----> <span class="site-name">Frontend Notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/frontend-notes/" aria-current="page" class="sidebar-link">前言</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/frontend-notes/javascript" class="sidebar-heading clickable router-link-active open"><span>JavaScript</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/frontend-notes/javascript/词法作用域.html" class="sidebar-link">词法作用域</a></li><li><a href="/frontend-notes/javascript/执行上下文.html" class="sidebar-link">执行上下文</a></li><li><a href="/frontend-notes/javascript/闭包.html" class="sidebar-link">闭包</a></li><li><a href="/frontend-notes/javascript/this.html" class="sidebar-link">this</a></li><li><a href="/frontend-notes/javascript/call&amp;apply&amp;bind.html" class="sidebar-link">call/apply/bind</a></li><li><a href="/frontend-notes/javascript/prototype.html" class="sidebar-link">原型&amp;继承</a></li><li><a href="/frontend-notes/javascript/promise.html" class="sidebar-link">Promise</a></li><li><a href="/frontend-notes/javascript/深浅拷贝.html" class="sidebar-link">深/浅拷贝</a></li><li><a href="/frontend-notes/javascript/事件循环.html" class="active sidebar-link">事件循环</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend-notes/javascript/事件循环.html#执行栈" class="sidebar-link">执行栈</a></li><li class="sidebar-sub-header"><a href="/frontend-notes/javascript/事件循环.html#任务队列" class="sidebar-link">任务队列</a></li><li class="sidebar-sub-header"><a href="/frontend-notes/javascript/事件循环.html#宏任务-微任务" class="sidebar-link">宏任务 &amp; 微任务</a></li></ul></li><li><a href="/frontend-notes/javascript/函数式编程.html" class="sidebar-link">函数式编程</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/frontend-notes/typescript" class="sidebar-heading clickable"><span>TypeScript</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/frontend-notes/browser" class="sidebar-heading clickable"><span>浏览器</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/frontend-notes/frame" class="sidebar-heading clickable"><span>框架</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/frontend-notes/project" class="sidebar-heading clickable"><span>工程化</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/frontend-notes/network" class="sidebar-heading clickable"><span>网络</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="事件循环"><a href="#事件循环" class="header-anchor">#</a> 事件循环</h1> <p>众所周知，JavaScript 是一门单线程语言，所谓单线程是指 JS 代码只能由一个主线程（main thread）来负责执行。单线程意味着代码只能按顺序执行，好处是代码编写简单，坏处是一旦出现耗时的操作容易造成阻塞。对于一个网页来说存在许多耗时的任务，比如发送网络请求，因此浏览器提供了不同种类的工作线程专门来执行这些任务，避免主线程的阻塞。通过工作线程处理并且在完成之后回调主线程的任务被称为异步任务，而在协调各种异步任务的过程中涉及了一个机制，称为<strong>事件循环</strong>。</p> <h2 id="执行栈"><a href="#执行栈" class="header-anchor">#</a> 执行栈</h2> <p>JavaScript 代码执行时存在一个执行栈，每调用一个函数前首先会创建对应的函数执行上下文推入执行栈中交由主线程执行，函数执行完毕后立即将其执行上下文从执行栈中弹出。</p> <h2 id="任务队列"><a href="#任务队列" class="header-anchor">#</a> 任务队列</h2> <p>一个函数就是一个任务，任务可以分为同步任务和异步任务，调用某些 API 会创建一个异步任务交给工作线程去执行，执行完毕后进行回调，比如 setTimeout，Promise.prototype.then 等。当调用 setTimeout 时，JS 引擎会向事件表注册一个事件及其回调，然后主线程继续执行其它同步任务，当定时器设定时间到达后，会从事件表中取出其回调函数推到一个任务队列中，等到主线程把同步任务执行完（也就是执行栈清空），就会去取出任务队列中第一个回调推入执行栈中执行，等执行完后再去取，如此循环往复。任务队列保证了回调函数执行的先后顺序。</p> <h2 id="宏任务-微任务"><a href="#宏任务-微任务" class="header-anchor">#</a> 宏任务 &amp; 微任务</h2> <p>其实任务又可以分为宏任务（MacroTask）与微任务（MicroTask），宏任务与微任务存放在不同的队列中，从宏任务队列取出一个宏任务之前总会先将微任务队列中所有微任务依次取出并执行，然后才取出一个宏任务执行，之后继续执行所有微任务，如此往复。所以可以认为微任务总是优先于宏任务执行。</p> <p>以下方式创建的都是微任务：</p> <ol><li>promise.then()</li> <li>new MutationObserver()</li></ol> <p>除了微任务，其它任务都是宏任务，包括但不限于：</p> <ol><li>setTimeout、setInterval</li> <li>DOM 事件</li> <li>网络请求</li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">2021/10/21 12:00:07</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/frontend-notes/javascript/深浅拷贝.html" class="prev">
        深/浅拷贝
      </a></span> <span class="next"><a href="/frontend-notes/javascript/函数式编程.html">
        函数式编程
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/frontend-notes/assets/js/app.70366b76.js" defer></script><script src="/frontend-notes/assets/js/2.3a2be5ef.js" defer></script><script src="/frontend-notes/assets/js/22.d41561ec.js" defer></script><script src="/frontend-notes/assets/js/3.22db767b.js" defer></script>
  </body>
</html>
