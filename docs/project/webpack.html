<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack | Frontend Notes</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/frontend-notes/logo.jpg">
    <link rel="manifest" href="/frontend-notes/manifest.json">
    <meta name="description" content="前端知识点">
    <meta name="theme-color" content="#3eaf7c">
    
    <link rel="preload" href="/frontend-notes/assets/css/0.styles.ba955196.css" as="style"><link rel="preload" href="/frontend-notes/assets/js/app.86b5d29c.js" as="script"><link rel="preload" href="/frontend-notes/assets/js/2.e95bb25f.js" as="script"><link rel="preload" href="/frontend-notes/assets/js/33.59fcbcb3.js" as="script"><link rel="preload" href="/frontend-notes/assets/js/3.9bbab2a0.js" as="script"><link rel="prefetch" href="/frontend-notes/assets/js/10.07208e3c.js"><link rel="prefetch" href="/frontend-notes/assets/js/11.2295e105.js"><link rel="prefetch" href="/frontend-notes/assets/js/12.88e70a27.js"><link rel="prefetch" href="/frontend-notes/assets/js/13.a94e6ad9.js"><link rel="prefetch" href="/frontend-notes/assets/js/14.f30d69c4.js"><link rel="prefetch" href="/frontend-notes/assets/js/15.e37e7d9c.js"><link rel="prefetch" href="/frontend-notes/assets/js/16.cd2a8c4b.js"><link rel="prefetch" href="/frontend-notes/assets/js/17.07ce46bd.js"><link rel="prefetch" href="/frontend-notes/assets/js/18.3e62edd2.js"><link rel="prefetch" href="/frontend-notes/assets/js/19.709338d1.js"><link rel="prefetch" href="/frontend-notes/assets/js/20.fda0228f.js"><link rel="prefetch" href="/frontend-notes/assets/js/21.403e4d23.js"><link rel="prefetch" href="/frontend-notes/assets/js/22.de828116.js"><link rel="prefetch" href="/frontend-notes/assets/js/23.68283ae0.js"><link rel="prefetch" href="/frontend-notes/assets/js/24.8a5cfd8e.js"><link rel="prefetch" href="/frontend-notes/assets/js/25.4f0337a1.js"><link rel="prefetch" href="/frontend-notes/assets/js/26.4d4208ed.js"><link rel="prefetch" href="/frontend-notes/assets/js/27.0cafa974.js"><link rel="prefetch" href="/frontend-notes/assets/js/28.2e115154.js"><link rel="prefetch" href="/frontend-notes/assets/js/29.a3f89054.js"><link rel="prefetch" href="/frontend-notes/assets/js/30.813aaa62.js"><link rel="prefetch" href="/frontend-notes/assets/js/31.d5db9ad6.js"><link rel="prefetch" href="/frontend-notes/assets/js/32.9a0417a0.js"><link rel="prefetch" href="/frontend-notes/assets/js/34.8e42a8d2.js"><link rel="prefetch" href="/frontend-notes/assets/js/35.acb6e1b1.js"><link rel="prefetch" href="/frontend-notes/assets/js/36.6c9ceb7b.js"><link rel="prefetch" href="/frontend-notes/assets/js/37.83e8389a.js"><link rel="prefetch" href="/frontend-notes/assets/js/4.56105f37.js"><link rel="prefetch" href="/frontend-notes/assets/js/5.0720a12b.js"><link rel="prefetch" href="/frontend-notes/assets/js/6.26f5c643.js"><link rel="prefetch" href="/frontend-notes/assets/js/7.79dcc9e6.js"><link rel="prefetch" href="/frontend-notes/assets/js/8.777e16f0.js"><link rel="prefetch" href="/frontend-notes/assets/js/9.c8c99db3.js">
    <link rel="stylesheet" href="/frontend-notes/assets/css/0.styles.ba955196.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/frontend-notes/" class="home-link router-link-active"><!----> <span class="site-name">Frontend Notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/frontend-notes/" aria-current="page" class="sidebar-link">前言</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/frontend-notes/javascript" class="sidebar-heading clickable"><span>JavaScript</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/frontend-notes/typescript" class="sidebar-heading clickable"><span>TypeScript</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/frontend-notes/browser" class="sidebar-heading clickable"><span>浏览器</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/frontend-notes/frame" class="sidebar-heading clickable"><span>框架</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/frontend-notes/project" class="sidebar-heading clickable router-link-active open"><span>工程化</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/frontend-notes/project/webpack.html" aria-current="page" class="active sidebar-link">webpack</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend-notes/project/webpack.html#概念" class="sidebar-link">概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend-notes/project/webpack.html#_1-入口-entry" class="sidebar-link">1. 入口（entry）</a></li><li class="sidebar-sub-header"><a href="/frontend-notes/project/webpack.html#_2-输出-output" class="sidebar-link">2. 输出（output）</a></li><li class="sidebar-sub-header"><a href="/frontend-notes/project/webpack.html#_3-加载器-loader" class="sidebar-link">3. 加载器（loader）</a></li><li class="sidebar-sub-header"><a href="/frontend-notes/project/webpack.html#_4-插件-plugin" class="sidebar-link">4. 插件（plugin）</a></li></ul></li><li class="sidebar-sub-header"><a href="/frontend-notes/project/webpack.html#指南" class="sidebar-link">指南</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend-notes/project/webpack.html#代码分离" class="sidebar-link">代码分离</a></li><li class="sidebar-sub-header"><a href="/frontend-notes/project/webpack.html#资源缓存" class="sidebar-link">资源缓存</a></li><li class="sidebar-sub-header"><a href="/frontend-notes/project/webpack.html#构建性能" class="sidebar-link">构建性能</a></li><li class="sidebar-sub-header"><a href="/frontend-notes/project/webpack.html#模块热替换-hmr" class="sidebar-link">模块热替换（HMR）</a></li><li class="sidebar-sub-header"><a href="/frontend-notes/project/webpack.html#tree-shaking" class="sidebar-link">Tree Shaking</a></li><li class="sidebar-sub-header"><a href="/frontend-notes/project/webpack.html#资源模块" class="sidebar-link">资源模块</a></li></ul></li><li class="sidebar-sub-header"><a href="/frontend-notes/project/webpack.html#参考" class="sidebar-link">参考</a></li></ul></li><li><a href="/frontend-notes/project/babel.html" class="sidebar-link">Babel</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/frontend-notes/network" class="sidebar-heading clickable"><span>网络</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack"><a href="#webpack" class="header-anchor">#</a> webpack</h1> <p>本质上，webpack 是一个 JavaScript 程序的静态资源打包工具。从应用程序的入口文件开始，webpack 会递归地解析文件的依赖并构建一个依赖图，最后将所有依赖的模块打包、输出为一个或多个 bundles。</p> <h2 id="概念"><a href="#概念" class="header-anchor">#</a> 概念</h2> <h3 id="_1-入口-entry"><a href="#_1-入口-entry" class="header-anchor">#</a> 1. 入口（entry）</h3> <blockquote><p>应用程序的入口文件路径，告诉 webpack 应该从哪些文件开始构建依赖图。</p></blockquote> <h3 id="_2-输出-output"><a href="#_2-输出-output" class="header-anchor">#</a> 2. 输出（output）</h3> <blockquote><p>所有的静态资源被打包后需要输出的位置。</p></blockquote> <h3 id="_3-加载器-loader"><a href="#_3-加载器-loader" class="header-anchor">#</a> 3. 加载器（loader）</h3> <blockquote><p>webpack 本身只能识别 JavaScript 和 JSON 文件，其它类型的资源需要相应的 loader 来解析、转换为有效的模块。</p></blockquote> <h3 id="_4-插件-plugin"><a href="#_4-插件-plugin" class="header-anchor">#</a> 4. 插件（plugin）</h3> <blockquote><p>插件为 webpack 提供了更多额外的能力。插件通过监听 webpack 运行期间不同生命周期事件，来执行各种操作。</p></blockquote> <h2 id="指南"><a href="#指南" class="header-anchor">#</a> 指南</h2> <h3 id="代码分离"><a href="#代码分离" class="header-anchor">#</a> 代码分离</h3> <p>通过代码分离，可以将一个大的 bundle 分离为多个较小的 bundle，然后按需或延迟加载，以提升应用的首次加载速度。</p> <p>代码分离实现方式有如下 3 种：</p> <ol><li>配置多个入口</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    a<span class="token operator">:</span> <span class="token string">&quot;./src/a.js&quot;</span><span class="token punctuation">,</span>
    b<span class="token operator">:</span> <span class="token string">&quot;./src/b.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>如果 <strong>a.js</strong> 和 <strong>b.js</strong> 都依赖 <strong>c.js</strong>，上述配置下输出的 2 个 bundle 都会包含 <strong>c.js</strong> 的代码。除此之外，2 个 bundle 都包含了相同的 webpack runtime 代码，要解决这些问题，可以参考如下配置：</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    a<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">import</span><span class="token operator">:</span> <span class="token string">&quot;./src/a.js&quot;</span><span class="token punctuation">,</span>
      dependOn<span class="token operator">:</span> <span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    b<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">import</span><span class="token operator">:</span> <span class="token string">&quot;./src/b.js&quot;</span><span class="token punctuation">,</span>
      dependOn<span class="token operator">:</span> <span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    c<span class="token operator">:</span> <span class="token string">&quot;./src/c.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    runtimeChunk<span class="token operator">:</span> <span class="token string">&quot;single&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 将 webpack runtime 提取为单独文件</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ol start="2"><li>splitChunks 提取公共依赖</li></ol> <p>方式 1 需要手动配置入口，很难维护，所以更推荐配置 <strong>optimization.splitChunks</strong> 来提取公共代码。</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
      cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span>
        shared<span class="token operator">:</span> <span class="token punctuation">{</span>
          chunks<span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 默认是 'async'，表示只会提取异步 chunk；另一个值是 'initial'，表示非异步 chunk</span>
          minSize<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 提取 chunk 的最小体积（以 bytes 为单位）</span>
          minChunks<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// 提取 chunk 的最少被共享数</span>
          name<span class="token operator">:</span> <span class="token string">&quot;shared&quot;</span><span class="token punctuation">,</span> <span class="token comment">// chunk 的名字</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li>动态导入</li></ol> <p>通过 <strong>import()</strong> 或 <strong>require.ensure()</strong> 动态导入的模块也会被单独分离。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 1. import()</span>
<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;./a.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">mod</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mod<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 2. require.ensure()</span>
require<span class="token punctuation">.</span><span class="token function">ensure</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> mod <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./a.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="资源缓存"><a href="#资源缓存" class="header-anchor">#</a> 资源缓存</h3> <p>浏览器从服务器获取前端代码是一个比较耗时的过程，其速度也是衡量前端性能的重要指标，十分影响用户的使用体验，因此浏览器都有一个缓存资源的优化机制，对于已经请求过的资源一般可以从缓存中获取，不必再次从服务器加载。为了有效的利用缓存机制，前端代码的构建需要做到：1. 内容有更新的 bundle 文件名也需要更新，这样浏览器就会加载新的 bundle；2. 内容无更新的 bundle 文件名应该不变，这样浏览器可以从缓存中获取。</p> <p>从 webpack 配置的角度来说，具体可以这么做：</p> <ol><li>配置输出文件名</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">&quot;[name].[contenthash].js&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 影响同步 chunk 名，基于内容添加 hash 值</span>
    chunkFilename<span class="token operator">:</span> <span class="token string">&quot;[name].[contenthash]&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 影响异步 chunk 名</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>关于 <strong>hash</strong>、<strong>chunkhash</strong>、<strong>contenthash</strong> 的区别</p> <ol><li><p><strong>hash</strong>。基于一次完整的编译（compilation）生成的 hash 值，只要一个文件内容有更改，所有 chunk 的 hash 都统一更新。</p></li> <li><p><strong>chunkhash</strong>。假设在 index.js 中导入 index.css 文件，并通过 mini-css-extract-plugin 插件提取 css，在配置 chunkhash 的情况下，输出的 index.js 和 index.css bundle 会带有相同 hash 值，这个值是由 index.js 与 index.css 组成的整个 chunk 的内容生成的，之后无论是 index.js 还是 index.css 内容改变，都会导致输出的 bundle hash 值改变。</p></li> <li><p><strong>contenthash</strong>。依然考虑上面那种场景，并配置 contenthash，此时输出的 index.js 和 index.css bundle 会带有不同的 hash 值，并且这些 hash 值是根据各自的文件内容生成的，不会互相影响。</p></li></ol> <p>总的来说，<strong>contenthash</strong> 会具有更稳定的 hash 值，更利于精确的缓存控制。</p></blockquote> <ol start="2"><li>提取第三方包到单独的 bundle 中</li></ol> <p>一般来说，项目中使用的第三方包是不需要经常更新的，最好能提取到单独的 bundle 中，这样业务代码更新后，依然能够利用缓存。</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
      cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 定义一个提取第三方模块的缓存组</span>
        vendors<span class="token operator">:</span> <span class="token punctuation">{</span>
          chunks<span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>
          test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 配置来自 node_modules 的模块</span>
          name<span class="token operator">:</span> <span class="token string">&quot;vendors&quot;</span><span class="token punctuation">,</span> <span class="token comment">// chunk 的名字</span>
          reuseExistingChunk<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li>采用稳定的模块 ID 方案</li></ol> <p>在输出的 bundle 中除了模块本身的内容，还包含 webpack 为模块分配的唯一标识符（ID），有时候，即使模块内容没有变化但是 ID 变了，也会导致输出的 bundle 变化，为了避免这种情况，应该采用更加稳定的 ID 方案。</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    moduleIds<span class="token operator">:</span> <span class="token string">&quot;deterministic&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 用模块 hash 转换成数字作为 ID</span>
    <span class="token comment">// 或</span>
    moduleIds<span class="token operator">:</span> <span class="token string">&quot;named&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 表示根据模块名字（路径）作为 ID</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="构建性能"><a href="#构建性能" class="header-anchor">#</a> 构建性能</h3> <ol><li>缩小 loader 的作用范围</li> <li>减少解析范围，如：resolve.modules resolve.extensions 等</li> <li>dll</li> <li>选择体积更小的库</li> <li>多线程</li> <li>开启构建缓存</li> <li>devtool 也会影响构建速度，选择合适的 devtool</li></ol> <h3 id="模块热替换-hmr"><a href="#模块热替换-hmr" class="header-anchor">#</a> 模块热替换（HMR）</h3> <p>模块热替换是一项能够极大提升开发效率的技术，它允许在运行时更新所有类型的模块，而无需刷新整个页面。</p> <p>从 webpack-dev-server v4.0.0 开始，热模块替换是默认开启的，不需要做额外的配置，只需要在代码中监听模块更新：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">&quot;lodash&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> printMe <span class="token keyword">from</span> <span class="token string">&quot;./print.js&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">component</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;button&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  btn<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">&quot;Click me and check the console!&quot;</span><span class="token punctuation">;</span>
  btn<span class="token punctuation">.</span>onclick <span class="token operator">=</span> printMe<span class="token punctuation">;</span>
  element<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;webpack&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  element<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>btn<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> element<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> element <span class="token operator">=</span> <span class="token function">component</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 存储 element，以在 print.js 修改时重新渲染</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>hot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 监听 print.js 的热更新</span>
  module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token string">&quot;./print.js&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 删除原有的 element</span>
    element <span class="token operator">=</span> <span class="token function">component</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 重新渲染 &quot;component&quot;，以便更新 click 事件处理函数</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="tree-shaking"><a href="#tree-shaking" class="header-anchor">#</a> Tree Shaking</h3> <p>Tree Shaking 是一种在 JavaScript 构建阶段移除代码中未被实际使用到的代码的技术。这项技术依赖于 ESM 模块语法（import / export）的静态结构特性。在 commonjs 模块语法中，导入导出允许写在条件语句中，因此只能在运行时判断模块是否被真正导入导出，而在 ESM 模块语法中，导入导出只能写在最外层，因此可以在构建阶段基于静态分析，去掉无用的代码。</p> <p>在 webpack 中启用 Tree Shaking 需要保证：</p> <ol><li>代码中使用 ESM 模块语法</li> <li>避免 ESM 模块语法被转译成 commonjs 模块语法</li> <li>开启 production 模式</li></ol> <h3 id="资源模块"><a href="#资源模块" class="header-anchor">#</a> 资源模块</h3> <p>webpack 5 之前常采用 <strong>raw-loader</strong>、<strong>url-loader</strong>、<strong>file-loader</strong> 来加载图片、字体、文本等其它类型资源。现在，webpack 5 内置了资源模块来代替这些 loader 。</p> <ol><li><strong>asset/resource</strong></li></ol> <blockquote><p>替代 <strong>file-loader</strong>，发送一个单独的文件并导出 URL 。</p></blockquote> <ol start="2"><li><strong>asset/inline</strong></li></ol> <blockquote><p>替代 <strong>url-loader</strong>，导出一个资源的 data URI。</p></blockquote> <ol start="3"><li><strong>asset/source</strong></li></ol> <blockquote><p>替代 <strong>raw-loader</strong>，出资源的原本。</p></blockquote> <ol start="4"><li><strong>asset</strong></li></ol> <blockquote><p>替代 <strong>url-loader</strong>，根据配置的资源体积限制，在导出一个 data URI 和发送一个单独的文件之间自动选择。</p></blockquote> <h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <ol><li><a href="https://webpack.docschina.org/concepts/" target="_blank" rel="noopener noreferrer">概念<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://webpack.docschina.org/guides/" target="_blank" rel="noopener noreferrer">指南<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://webpack.docschina.org/guides/code-splitting/" target="_blank" rel="noopener noreferrer">代码分离<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://webpack.docschina.org/guides/caching/" target="_blank" rel="noopener noreferrer">缓存<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://webpack.docschina.org/guides/build-performance/" target="_blank" rel="noopener noreferrer">构建性能<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://webpack.docschina.org/guides/hot-module-replacement/" target="_blank" rel="noopener noreferrer">模块热替换<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://webpack.docschina.org/guides/tree-shaking/" target="_blank" rel="noopener noreferrer">Tree Shaking<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://webpack.docschina.org/guides/asset-modules/" target="_blank" rel="noopener noreferrer">资源模块<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">2021/11/20 17:15:52</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/frontend-notes/frame/React 实战技巧.html" class="prev">
        React 实战技巧
      </a></span> <span class="next"><a href="/frontend-notes/project/babel.html">
        Babel
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/frontend-notes/assets/js/app.86b5d29c.js" defer></script><script src="/frontend-notes/assets/js/2.e95bb25f.js" defer></script><script src="/frontend-notes/assets/js/33.59fcbcb3.js" defer></script><script src="/frontend-notes/assets/js/3.9bbab2a0.js" defer></script>
  </body>
</html>
