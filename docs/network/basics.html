<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>网络基础 | Frontend Notes</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/frontend-notes/logo.jpg">
    <link rel="manifest" href="/frontend-notes/manifest.json">
    <meta name="description" content="前端知识点">
    <meta name="theme-color" content="#3eaf7c">
    
    <link rel="preload" href="/frontend-notes/assets/css/0.styles.b070197c.css" as="style"><link rel="preload" href="/frontend-notes/assets/js/app.8d849bfa.js" as="script"><link rel="preload" href="/frontend-notes/assets/js/2.3a2be5ef.js" as="script"><link rel="preload" href="/frontend-notes/assets/js/29.332a1785.js" as="script"><link rel="preload" href="/frontend-notes/assets/js/7.4efd9018.js" as="script"><link rel="preload" href="/frontend-notes/assets/js/3.22db767b.js" as="script"><link rel="prefetch" href="/frontend-notes/assets/js/10.24e8fdb8.js"><link rel="prefetch" href="/frontend-notes/assets/js/11.28093841.js"><link rel="prefetch" href="/frontend-notes/assets/js/12.cbf5eeeb.js"><link rel="prefetch" href="/frontend-notes/assets/js/13.93d25daf.js"><link rel="prefetch" href="/frontend-notes/assets/js/14.bdf1cdfb.js"><link rel="prefetch" href="/frontend-notes/assets/js/15.b666144e.js"><link rel="prefetch" href="/frontend-notes/assets/js/16.6a95be55.js"><link rel="prefetch" href="/frontend-notes/assets/js/17.7d9dce32.js"><link rel="prefetch" href="/frontend-notes/assets/js/18.08b081ea.js"><link rel="prefetch" href="/frontend-notes/assets/js/19.deb6eba7.js"><link rel="prefetch" href="/frontend-notes/assets/js/20.a97c8939.js"><link rel="prefetch" href="/frontend-notes/assets/js/21.d9435ffa.js"><link rel="prefetch" href="/frontend-notes/assets/js/22.d41561ec.js"><link rel="prefetch" href="/frontend-notes/assets/js/23.9f6984bc.js"><link rel="prefetch" href="/frontend-notes/assets/js/24.20970c33.js"><link rel="prefetch" href="/frontend-notes/assets/js/25.fe946786.js"><link rel="prefetch" href="/frontend-notes/assets/js/26.c2a48529.js"><link rel="prefetch" href="/frontend-notes/assets/js/27.af47dc56.js"><link rel="prefetch" href="/frontend-notes/assets/js/28.b3939b4c.js"><link rel="prefetch" href="/frontend-notes/assets/js/30.f51dc6c7.js"><link rel="prefetch" href="/frontend-notes/assets/js/31.e03525c2.js"><link rel="prefetch" href="/frontend-notes/assets/js/32.18a3a393.js"><link rel="prefetch" href="/frontend-notes/assets/js/33.0b87f05a.js"><link rel="prefetch" href="/frontend-notes/assets/js/34.0cf8e4b9.js"><link rel="prefetch" href="/frontend-notes/assets/js/35.f36c603a.js"><link rel="prefetch" href="/frontend-notes/assets/js/36.a3fa12d9.js"><link rel="prefetch" href="/frontend-notes/assets/js/37.d11052f5.js"><link rel="prefetch" href="/frontend-notes/assets/js/38.3a332fc7.js"><link rel="prefetch" href="/frontend-notes/assets/js/39.885e7913.js"><link rel="prefetch" href="/frontend-notes/assets/js/4.5936c4c4.js"><link rel="prefetch" href="/frontend-notes/assets/js/40.dc1e682c.js"><link rel="prefetch" href="/frontend-notes/assets/js/41.f7bbec3a.js"><link rel="prefetch" href="/frontend-notes/assets/js/5.33850136.js"><link rel="prefetch" href="/frontend-notes/assets/js/6.51684ca2.js"><link rel="prefetch" href="/frontend-notes/assets/js/8.fc42a4c2.js"><link rel="prefetch" href="/frontend-notes/assets/js/9.39059156.js">
    <link rel="stylesheet" href="/frontend-notes/assets/css/0.styles.b070197c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/frontend-notes/" class="home-link router-link-active"><!----> <span class="site-name">Frontend Notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/frontend-notes/" aria-current="page" class="sidebar-link">前言</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/frontend-notes/javascript" class="sidebar-heading clickable"><span>JavaScript</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/frontend-notes/typescript" class="sidebar-heading clickable"><span>TypeScript</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/frontend-notes/browser" class="sidebar-heading clickable"><span>浏览器</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/frontend-notes/frame" class="sidebar-heading clickable"><span>框架</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/frontend-notes/project" class="sidebar-heading clickable"><span>工程化</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/frontend-notes/network" class="sidebar-heading clickable router-link-active open"><span>网络</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/frontend-notes/network/basics.html" aria-current="page" class="active sidebar-link">网络基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend-notes/network/basics.html#tcp-ip" class="sidebar-link">TCP/IP</a></li><li class="sidebar-sub-header"><a href="/frontend-notes/network/basics.html#协议栈-套接字" class="sidebar-link">协议栈&amp;套接字</a></li><li class="sidebar-sub-header"><a href="/frontend-notes/network/basics.html#tcp-协议" class="sidebar-link">TCP 协议</a></li></ul></li><li><a href="/frontend-notes/network/http.html" class="sidebar-link">HTTP</a></li><li><a href="/frontend-notes/network/http-cache.html" class="sidebar-link">HTTP 缓存</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="网络基础"><a href="#网络基础" class="header-anchor">#</a> 网络基础</h1> <h2 id="tcp-ip"><a href="#tcp-ip" class="header-anchor">#</a> TCP/IP</h2> <p>TCP/IP 协议族是网络通信中各种协议的集合，并且为了便于复用协议与适配各种网络场景，采用分层架构：</p> <ol><li>应用层</li></ol> <blockquote><p>应用层是直接面向应用程序的，这一层的常用协议包括：HTTP、WS、FTP、DNS等。</p></blockquote> <ol start="2"><li>传输层</li></ol> <blockquote><p>传输层协议：TCP（Transmission Control Protocol，传输控制协议）、UDP（User Data Protocol，用户数据报协议）。</p></blockquote> <ol start="3"><li>网络层</li></ol> <blockquote><p>网络层通过 IP 协议将数据包加上 IP 首部，交由链路层发出。</p></blockquote> <ol start="4"><li>链路层</li></ol> <blockquote><p>链路层包括网络中的硬件部分以及相关驱动程序，比如：网卡、光纤、路由器等。</p></blockquote> <div class="image-box" data-v-63754a5e><div class="img" data-v-63754a5e><img src="/frontend-notes/images/tcp-ip.jpg" data-v-63754a5e></div> <div class="title" data-v-63754a5e>TCP/IP 分层架构</div></div> <div class="image-box" data-v-63754a5e><div class="img" data-v-63754a5e><img src="/frontend-notes/images/tcp-ip-layer.jpg" data-v-63754a5e></div> <div class="title" data-v-63754a5e>TCP/IP 分层封装</div></div> <h2 id="协议栈-套接字"><a href="#协议栈-套接字" class="header-anchor">#</a> 协议栈&amp;套接字</h2> <p>协议栈是在操作系统中实现的网络控制软件，其组成架构包含由 TCP 协议、UDP 协议组成的传输层和 IP 协议构成的网络层。有了协议栈，应用程序要通过网络收发数据时，只需要准备好数据，然后委托操作系统的协议栈将数据发送出去，不需要关心具体的操作细节。</p> <p>具体来说，应用程序委托协议栈收发数据是通过创建套接字（Socket）实现的。所谓套接字，其实就是一块内存空间，它保存了一次网络连接中的一些关键控制信息，比如：通信对象的 IP 地址和端口号、本地的 IP 地址和端口号、使用的传输层协议类型（TCP 或 UDP）、连接的当前状态等。其实网络连接可以简单的想象为在通信双方两台计算机中的某个套接字之间创建了一个条管道，然后数据经由这条管道流通，最终交给对应的应用程序进行处理。</p> <div class="image-box" data-v-63754a5e><div class="img" data-v-63754a5e><img src="/frontend-notes/images/socket.jpg" data-v-63754a5e></div> <div class="title" data-v-63754a5e>委托协议栈</div></div> <p>应用程序向套接字写入数据（即发送数据）时，并不是立刻将数据发送出去，而是将数据暂时存在缓冲区中，等累计达到一个阈值后再合成一个网络包发送，这样可以避免频繁的发送过小的网络包，提升网络传输效率。一个网络包中，除了真正的数据，还有包含头部数据（TCP 头部和 IP 头部），数据被拆分成网络包的数量越多，需要重复发送的头部也就越多，效率也就越低。</p> <p>上面提到的阈值是怎么确定的呢？协议栈会根据一个叫作 MTU（Maximum Transmission Unit，最大传输单元） 的参数来确定，MTU 表示一个网络包的最大长度，在以太网中一般是 1500 字节。然后用 MTU 减去头部的长度之后就是一个网络包所能容纳的最大数据长度，叫做 MSS（Maximum Segment Size，最大分段大小），TCP 头部和 IP 头部总长一般是 40 字节，因此 MSS 一般就是 1460 字节，这个值就上面提到的阈值。</p> <div class="image-box" data-v-63754a5e><div class="img" data-v-63754a5e><img src="/frontend-notes/images/mtu-mss.jpg" data-v-63754a5e></div> <div class="title" data-v-63754a5e>MTU 与 MSS</div></div> <p>如果数据在缓冲区的存放时间太长，就会导致网络延迟很高。因此，协议栈内部会有一个计时器，达到一定时间也会立刻将数据发送出去，一般也就是毫秒级。</p> <h2 id="tcp-协议"><a href="#tcp-协议" class="header-anchor">#</a> TCP 协议</h2> <p>采用 TCP 协议发送数据时，需要在数据前面加上 TCP 头部。</p> <div class="image-box" data-v-63754a5e><div class="img" data-v-63754a5e><img src="/frontend-notes/images/tcp-head.jpg" data-v-63754a5e></div> <div class="title" data-v-63754a5e>TCP 头部格式</div></div> <p>在发送数据之前，必须在通信双方之间建立 TCP 连接，即握手，分为 3 个步骤：</p> <ol><li>客户端（即连接发起方）创建一个 TCP 头部，将控制位的 SYN 设置为 1，委托 IP 模块发送网络包；</li> <li>服务器收到之后，创建一个 TCP 头部，将控制位的 SYN 和 ACK 设置为 1，委托 IP 模块发送网络包；</li> <li>客户端收到之后，再次创建一个 TCP 头部，将控制位的 ACK 设置为 1，委托 IP 模块将网络包发出；</li></ol> <p>经历这 3 次握手阶段之后，TCP 连接才算建立完成，可以开始发送数据了。</p> <p>发送数据过程中，TCP 会确认对方是否成功收到网络包，如果对方没有收到则会及时重发，所以这里存在一个确认的机制。具体来说，在 TCP 头部中有一个序号字段，表示当前网络包中的数据相当于所有发送数据中的第几个字节，如果接收方顺利收到网络包，接收方会将这个序号值加上数据的长度，并将得到的结果设置到 TCP 头部的 ACK 字段（接收数据序号）中，返回网络包给发送方，表示这个序号之前的数据已经收到，如果发送方一直等不到返回的 ACK 确认网络包（等待时间是动态调节的，一般至少是 0.5 到 1 秒），则会重新发送网络包。另外，其实在 TCP 握手第一阶段，客户端发送的 TCP 头部中就已经包含了一个初始序号值（随机产生的），后续的序号值是从初始序号值的基础上进行增加的，由于 TCP 是允许双向通讯的，所以在握手第二阶段，服务器返回的 TCP 头部中也包含了从服务器发送到客户端的数据初始序号值。</p> <div class="image-box" data-v-63754a5e><div class="img" data-v-63754a5e><img src="/frontend-notes/images/tcp-ack.jpg" data-v-63754a5e></div> <div class="title" data-v-63754a5e>序号和 ACK 号交互</div></div> <p>在实际的 TCP 连接中，一方发送完一个网络包后，并不会等待对方的 ACK 号，而是可能按顺序连续发送多个网络包，这样对方只需要返回一个最新的 ACK 号即可确认收到了该序号之前的所有数据。那么应该连续发送多少网络包呢？首先答案肯定不是越多越好，因为 TCP 的接收方的接收缓冲区是有限的，如果发送的数据量超出了对方的接收缓冲区容量，那么超出的数据就丢失了。所以，发送方要根据接收方目前接收缓冲区的剩余容量来决定最多发送多少数据。对此，TCP 采用滑动窗口的方式来优化网络包的发送。具体来说，TCP 连接中的任何一方发出网络包时，都会通过在 TCP 头部中窗口字段设置当前窗口大小（即无需等待 ACK 号连续发送的数据量）来告诉对方，包括握手阶段中的网络包。</p> <div class="image-box" data-v-63754a5e><div class="img" data-v-63754a5e><img src="/frontend-notes/images/tcp-slide-window.jpg" data-v-63754a5e></div> <div class="title" data-v-63754a5e>滑动窗口</div></div> <p>当所有数据发送完毕，可以由任意一方发起断开 TCP 连接的操作，即挥手，分为 4 个步骤：</p> <ol><li>客户端创建一个 TCP 头部，将控制位的 FIN 设置为 1，委托 IP 模块发送网络包；</li> <li>服务器收到之后，创建一个 TCP 头部，将控制位的 ACK 设置为1，委托 IP 模块发送网络包；</li> <li>服务器创建一个 TCP 头部，将控制位的 FIN 设置为 1，委托 IP 模块发送网络包；</li> <li>客户端收到之后，创建一个 TCP 头部，将控制位的 ACK 设置为1，委托 IP 模块发送网络包。</li></ol> <p>经历这 4 次挥手之后，TCP 连接完全断开，通信双方的套接字不再使用，并在保留一段时间后被删除。</p> <div class="image-box" data-v-63754a5e><div class="img" data-v-63754a5e><img src="/frontend-notes/images/tcp-close.jpg" data-v-63754a5e></div> <div class="title" data-v-63754a5e>TCP 断开连接</div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">2021/12/04 19:51:55</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/frontend-notes/project/babel.html" class="prev">
        Babel
      </a></span> <span class="next"><a href="/frontend-notes/network/http.html">
        HTTP
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/frontend-notes/assets/js/app.8d849bfa.js" defer></script><script src="/frontend-notes/assets/js/2.3a2be5ef.js" defer></script><script src="/frontend-notes/assets/js/29.332a1785.js" defer></script><script src="/frontend-notes/assets/js/7.4efd9018.js" defer></script><script src="/frontend-notes/assets/js/3.22db767b.js" defer></script>
  </body>
</html>
